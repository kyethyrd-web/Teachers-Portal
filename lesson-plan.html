<!DOCTYPE html>
<html>
<head>
  <title>Daily Lesson Log</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    td {
      border: 1px solid black;
      padding: 8px;
    }
    .label {
      width: 25%;
      font-weight: bold;
    }
    .editable {
      width: 75%;
    }
  </style>
</head>
<body>

<h2>Daily Lesson Log</h2>

<label>Select Date:</label>
<input type="date" id="lessonDate">
<button onclick="loadLesson()">Load Lesson</button>

<br><br>

<table>
  <tr>
    <td class="label">School</td>
    <td class="editable" contenteditable="true" id="school"></td>
  </tr>
  <tr>
    <td class="label">Teacher</td>
    <td class="editable" contenteditable="true" id="teacher"></td>
  </tr>
  <tr>
    <td class="label">Grade Level</td>
    <td class="editable" contenteditable="true" id="gradeLevel"></td>
  </tr>
  <tr>
    <td class="label">Learning Area</td>
    <td class="editable" contenteditable="true" id="learningArea"></td>
  </tr>
  <tr>
    <td class="label">Quarter</td>
    <td class="editable" contenteditable="true" id="quarter"></td>
  </tr>
</table>

<br>

<table>
  <tr>
    <td class="label">Objectives</td>
    <td class="editable" contenteditable="true" id="objectives"></td>
  </tr>
  <tr>
    <td class="label">Content</td>
    <td class="editable" contenteditable="true" id="content"></td>
  </tr>
  <tr>
    <td class="label">Procedures</td>
    <td class="editable" contenteditable="true" id="procedures"></td>
  </tr>
  <tr>
    <td class="label">Assessment</td>
    <td class="editable" contenteditable="true" id="assessment"></td>
  </tr>
  <tr>
    <td class="label">Assignment</td>
    <td class="editable" contenteditable="true" id="assignment"></td>
  </tr>
  <tr>
    <td class="label">Remarks</td>
    <td class="editable" contenteditable="true" id="remarks"></td>
  </tr>
</table>

<br>

<button onclick="saveLesson()">Save Lesson Plan</button>
<p id="status"></p>

<script type="module">

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDmb0oDlQVfEhcqx6OPgmWwump0b0R09xs",
    authDomain: "teachers-portal-98254.firebaseapp.com",
    projectId: "teachers-portal-98254",
    storageBucket: "teachers-portal-98254.firebasestorage.app",
    messagingSenderId: "479254583768",
    appId: "1:479254583768:web:b8dcf9da3a5616d5b37aad"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
    } else {
      window.location.href = "login.html";
    }
  });

  // Save lesson based on date
  window.saveLesson = async function() {
    const date = document.getElementById("lessonDate").value;

    if (!date) {
      document.getElementById("status").innerText = "Please select a date.";
      return;
    }

    const lesson = {
      school: document.getElementById("school").innerText,
      teacher: document.getElementById("teacher").innerText,
      gradeLevel: document.getElementById("gradeLevel").innerText,
      learningArea: document.getElementById("learningArea").innerText,
      quarter: document.getElementById("quarter").innerText,
      objectives: document.getElementById("objectives").innerText,
      content: document.getElementById("content").innerText,
      procedures: document.getElementById("procedures").innerText,
      assessment: document.getElementById("assessment").innerText,
      assignment: document.getElementById("assignment").innerText,
      remarks: document.getElementById("remarks").innerText,
      userId: currentUser.uid,
      date: date
    };

    try {
      await setDoc(doc(db, "lessonPlans", currentUser.uid + "_" + date), lesson);
      document.getElementById("status").innerText = "Lesson plan saved!";
    } catch (error) {
      document.getElementById("status").innerText = error.message;
    }
  }

  // Load lesson by date
  window.loadLesson = async function() {
    const date = document.getElementById("lessonDate").value;

    if (!date) {
      document.getElementById("status").innerText = "Select a date to load.";
      return;
    }

    const docRef = doc(db, "lessonPlans", currentUser.uid + "_" + date);
    const docSnap = await getDoc(docRef);

    if (docSnap.exists()) {
      const data = docSnap.data();

      document.getElementById("school").innerText = data.school || "";
      document.getElementById("teacher").innerText = data.teacher || "";
      document.getElementById("gradeLevel").innerText = data.gradeLevel || "";
      document.getElementById("learningArea").innerText = data.learningArea || "";
      document.getElementById("quarter").innerText = data.quarter || "";
      document.getElementById("objectives").innerText = data.objectives || "";
      document.getElementById("content").innerText = data.content || "";
      document.getElementById("procedures").innerText = data.procedures || "";
      document.getElementById("assessment").innerText = data.assessment || "";
      document.getElementById("assignment").innerText = data.assignment || "";
      document.getElementById("remarks").innerText = data.remarks || "";

      document.getElementById("status").innerText = "Lesson loaded!";
    } else {
      document.getElementById("status").innerText = "No lesson for this date.";
      
      // Clear fields
      document.querySelectorAll(".editable").forEach(el => el.innerText = "");
    }
  }

</script>

</body>
</html>
