<!DOCTYPE html>
<html>
<head>
  <title>Daily Lesson Log</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    td {
      border: 1px solid black;
      padding: 6px;
    }
    select, input {
      width: 100%;
    }
    .editable {
      min-height: 40px;
    }
  </style>
</head>
<body>

<h2>Daily Lesson Log</h2>

<label>Select Date</label>
<input type="date" id="lessonDate">
<button onclick="loadLesson()">Load</button>

<br><br>

<!-- TABLE 1 -->
<table id="headerTable">
  <tr>
    <td>School</td>
    <td id="school" class="editable"></td>
    <td>Grade Level</td>
    <td>
      <select id="gradeLevel">
        <option>1</option><option>2</option><option>3</option><option>4</option>
        <option>5</option><option>6</option><option>7</option><option>8</option>
        <option>9</option><option>10</option><option>11</option><option>12</option>
      </select>
    </td>
  </tr>
  <tr>
    <td>Teacher</td>
    <td id="teacher" class="editable"></td>
    <td>Learning Area</td>
    <td>
      <select id="learningArea">
        <option>English</option>
        <option>Math</option>
        <option>ESP</option>
        <option>Araling Panlipunan</option>
        <option>MAPEH</option>
        <option>Science</option>
        <option>TLE</option>
        <option>Filipino</option>
        <option>Others</option>
      </select>
    </td>
  </tr>
  <tr>
    <td>Teaching Dates and Time</td>
    <td id="teachingTime" class="editable"></td>
    <td>Quarter</td>
    <td>
      <select id="quarter">
        <option>1st</option>
        <option>2nd</option>
        <option>3rd</option>
        <option>4th</option>
      </select>
    </td>
  </tr>
</table>

<br>

<!-- TABLE 2 -->
<table id="proceduresTable">
  <tr>
    <td></td>
    <td>MONDAY</td>
    <td>TUESDAY</td>
    <td>WEDNESDAY</td>
    <td>THURSDAY</td>
    <td>FRIDAY</td>
  </tr>
  <tr>
    <td>Date</td>
    <td id="dateMon"></td>
    <td id="dateTue"></td>
    <td id="dateWed"></td>
    <td id="dateThu"></td>
    <td id="dateFri"></td>
  </tr>
  <tr>
    <td>I. OBJECTIVES</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>A. GRADE LEVEL STANDARDS</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>B. Learning Competency</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>II. CONTENT</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>III. LEARNING RESOURCES</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>A. References</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>1. Additional Materials from LR Portal</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>B. Other Learning Resources</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>IV. PROCEDURES</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>A. Reviewing previous lesson</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>B. Establish a purpose</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>C. Examples/Instances</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>D. Discussing skills #1</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>E. Discussing skills #2</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>F. Developing Mastery</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>G. Applications</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>H. Generalization</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>I. Evaluating Learning</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>J. Additional activities</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>V. Remarks</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td>VI. Reflections</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
</table>

<br>

<button onclick="saveLesson()">Save Lesson</button>
<p id="status"></p>

<script type="module">

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyDmb0oDlQVfEhcqx6OPgmWwump0b0R09xs",
  authDomain: "teachers-portal-98254.firebaseapp.com",
  projectId: "teachers-portal-98254",
  storageBucket: "teachers-portal-98254.firebasestorage.app",
  messagingSenderId: "479254583768",
  appId: "1:479254583768:web:b8dcf9da3a5616d5b37aad"
};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      loadProfile();
    } else {
      window.location.href = "login.html";
    }
  });

  async function loadProfile() {
    const docRef = doc(db, "users", currentUser.uid);
    const snap = await getDoc(docRef);

    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("school").innerText = data.school || "";
      document.getElementById("teacher").innerText = data.name || "";
    }
  }

  function getMonday(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1);
    return new Date(d.setDate(diff));
  }

  function fillWeekDates(date) {
    const monday = getMonday(date);
    const days = [
      document.getElementById("dateMon"),
      document.getElementById("dateTue"),
      document.getElementById("dateWed"),
      document.getElementById("dateThu"),
      document.getElementById("dateFri")
    ];

    for (let i = 0; i < 5; i++) {
      const day = new Date(monday);
      day.setDate(monday.getDate() + i);
      days[i].innerText = day.toISOString().split('T')[0];
    }
  }

  window.loadLesson = async function() {
    const date = document.getElementById("lessonDate").value;
    if (!date) return;

    fillWeekDates(date);

    const docRef = doc(db, "lessonPlans", currentUser.uid + "_" + date);
    const snap = await getDoc(docRef);

    if (snap.exists()) {
      const data = snap.data();

      document.getElementById("gradeLevel").value = data.gradeLevel;
      document.getElementById("learningArea").value = data.learningArea;
      document.getElementById("quarter").value = data.quarter;
      document.getElementById("teachingTime").innerText = data.teachingTime;

      document.getElementById("proceduresTable").innerHTML = data.tableHTML;
    }
  }

  window.saveLesson = async function() {
    const date = document.getElementById("lessonDate").value;
    if (!date) return;

    const lesson = {
      school: document.getElementById("school").innerText,
      teacher: document.getElementById("teacher").innerText,
      gradeLevel: document.getElementById("gradeLevel").value,
      learningArea: document.getElementById("learningArea").value,
      quarter: document.getElementById("quarter").value,
      teachingTime: document.getElementById("teachingTime").innerText,
      tableHTML: document.getElementById("proceduresTable").innerHTML,
      date: date,
      userId: currentUser.uid
    };

    await setDoc(doc(db, "lessonPlans", currentUser.uid + "_" + date), lesson);
    document.getElementById("status").innerText = "Lesson saved!";
  }

</script>

</body>
</html>
