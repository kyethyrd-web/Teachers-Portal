<!DOCTYPE html>
<html>
<head>
  <title>Daily Lesson Log</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    td {
      border: 1px solid black;
      padding: 6px;
    }
    select, input {
      width: 100%;
    }
    .editable {
      min-height: 40px;
    }
  </style>
</head>
<body>

<h2>Daily Lesson Log</h2>

<label>Select Date</label>
<input type="date" id="lessonDate">
<button onclick="loadLesson()">Load</button>

<br><br>

<!-- TABLE 1 -->
<table id="headerTable">
  <tr>
    <td>School</td>
    <td id="school" class="editable"></td>
    <td>Grade Level</td>
    <td>
      <select id="gradeLevel">
        <option>1</option><option>2</option><option>3</option><option>4</option>
        <option>5</option><option>6</option><option>7</option><option>8</option>
        <option>9</option><option>10</option><option>11</option><option>12</option>
      </select>
    </td>
  </tr>
  <tr>
    <td>Teacher</td>
    <td id="teacher" class="editable"></td>
    <td>Learning Area</td>
    <td>
      <select id="learningArea">
        <option>English</option>
        <option>Math</option>
        <option>ESP</option>
        <option>Araling Panlipunan</option>
        <option>MAPEH</option>
        <option>Science</option>
        <option>TLE</option>
        <option>Filipino</option>
        <option>Others</option>
      </select>
    </td>
  </tr>
  <tr>
    <td>Teaching Dates and Time</td>
    <td id="teachingTime" class="editable"></td>
    <td>Quarter</td>
    <td>
      <select id="quarter">
        <option>1st</option>
        <option>2nd</option>
        <option>3rd</option>
        <option>4th</option>
      </select>
    </td>
  </tr>
</table>

<br>

<!-- TABLE 2 -->
<table id="proceduresTable">
  <tr>
    <td></td>
    <td>MONDAY</td>
    <td>TUESDAY</td>
    <td>WEDNESDAY</td>
    <td>THURSDAY</td>
    <td>FRIDAY</td>
  </tr>
  <tr>
    <td>Date</td>
    <td class="editable"></td>
    <td class="editable"></td>
    <td class="editable"></td>
    <td class="editable"></td>
    <td class="editable"></td>
  </tr>
  <tr>
    <td>I. OBJECTIVES</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>A. GRADE LEVEL STANDARDS</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>B. Learning Competency</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>II. CONTENT</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>III. LEARNING RESOURCES</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>A. References</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>1. Additional Materials from Learning Resources (LR) Portal</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>B. Other Learning Resources</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>IV. PROCEDURES</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>A. Reviewing previous lesson or presenting the new lesson</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>B. Establish a purpose for the lesson</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>C. Presenting Examples/Instances of new lesson</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>D. Discussing new concepts and practicing skills #1</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>E. Discussing new concepts and practicing skills #2</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>F. Developing Mastery</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>G. Applications in daily living</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>H. Generalization</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>I. Evaluating Learning</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>J. Additional activities</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>V. Remarks</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>VI. Reflections</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>A. No. of learners who earned 80%</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>B. No. of learners needing remediation</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>C. Did remedial lessons work?</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>D. Learners continuing remediation</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>E. Teaching strategies that worked</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>F. Difficulties encountered</td>
    <td class="editable" colspan="5"></td>
  </tr>
  <tr>
    <td>G. Innovations used</td>
    <td class="editable" colspan="5"></td>
  </tr>
</table>

<br>

<button onclick="saveLesson()">Save Lesson</button>
<p id="status"></p>

<script type="module">

  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDmb0oDlQVfEhcqx6OPgmWwump0b0R09xs",
    authDomain: "teachers-portal-98254.firebaseapp.com",
    projectId: "teachers-portal-98254",
    storageBucket: "teachers-portal-98254.firebasestorage.app",
    messagingSenderId: "479254583768",
    appId: "1:479254583768:web:b8dcf9da3a5616d5b37aad"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;

  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      loadProfile();
    } else {
      window.location.href = "login.html";
    }
  });

  // Load profile data for school and teacher
  async function loadProfile() {
    const docRef = doc(db, "users", currentUser.uid);
    const snap = await getDoc(docRef);

    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("school").innerText = data.school || "";
      document.getElementById("teacher").innerText = data.name || "";
    }
  }

  // Save lesson by date
  window.saveLesson = async function() {
    const date = document.getElementById("lessonDate").value;

    if (!date) {
      document.getElementById("status").innerText = "Select a date.";
      return;
    }

    const lesson = {
      school: document.getElementById("school").innerText,
      teacher: document.getElementById("teacher").innerText,
      gradeLevel: document.getElementById("gradeLevel").value,
      learningArea: document.getElementById("learningArea").value,
      quarter: document.getElementById("quarter").value,
      teachingTime: document.getElementById("teachingTime").innerText,
      tableHTML: document.getElementById("proceduresTable").innerHTML,
      date: date,
      userId: currentUser.uid
    };

    try {
      await setDoc(doc(db, "lessonPlans", currentUser.uid + "_" + date), lesson);
      document.getElementById("status").innerText = "Lesson saved!";
    } catch (error) {
      document.getElementById("status").innerText = error.message;
    }
  }

  // Load lesson by date
  window.loadLesson = async function() {
    const date = document.getElementById("lessonDate").value;

    if (!date) {
      document.getElementById("status").innerText = "Select a date.";
      return;
    }

    const docRef = doc(db, "lessonPlans", currentUser.uid + "_" + date);
    const snap = await getDoc(docRef);

    if (snap.exists()) {
      const data = snap.data();

      document.getElementById("gradeLevel").value = data.gradeLevel || "1";
      document.getElementById("learningArea").value = data.learningArea || "English";
      document.getElementById("quarter").value = data.quarter || "1st";
      document.getElementById("teachingTime").innerText = data.teachingTime || "";
      document.getElementById("proceduresTable").innerHTML = data.tableHTML || document.getElementById("proceduresTable").innerHTML;

      document.getElementById("status").innerText = "Lesson loaded!";
    } else {
      document.getElementById("status").innerText = "No lesson for this date.";
    }
  }

</script>

</body>
</html>
