<!DOCTYPE html>
<html>
<head>
  <title>Daily Lesson Log</title>

  <style>
    body {
      font-family: Arial;
      margin: 20px;
    }

    h2 {
      margin-bottom: 10px;
    }

    .top-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
    }

    input[type="date"] {
      width: 160px; /* shorter date box */
      padding: 5px;
    }

    button {
      padding: 6px 12px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    td {
      border: 1px solid black;
      padding: 6px;
      vertical-align: top;
    }

    select, input[type="text"] {
      width: 100%;
      padding: 4px;
    }

    .editable {
      min-height: 50px;
    }

    .indent-1 { padding-left: 20px; }
    .indent-2 { padding-left: 40px; }

  </style>
</head>
<body>

<h2>Daily Lesson Log</h2>

<div class="top-bar">
  <button onclick="location.href='profile.html'">Home</button>
  <input type="date" id="lessonDate">
  <button onclick="loadLesson()">Load</button>
</div>

<!-- HEADER TABLE -->
<table>
  <tr>
    <td>School</td>
    <td id="school"></td>
    <td>Grade Level</td>
    <td>
      <select id="gradeLevel">
        <option>1</option><option>2</option><option>3</option><option>4</option>
        <option>5</option><option>6</option><option>7</option><option>8</option>
        <option>9</option><option>10</option><option>11</option><option>12</option>
      </select>
    </td>
  </tr>

  <tr>
    <td>Teacher</td>
    <td id="teacher"></td>
    <td>Learning Area</td>
    <td>
  <select id="learningArea" onchange="checkLearningArea(this)">
    <option value="">Select Learning Area</option>
    <option>English</option>
    <option>Math</option>
    <option>ESP</option>
    <option>Araling Panlipunan</option>
    <option>MAPEH</option>
    <option>Science</option>
    <option>TLE</option>
    <option>Filipino</option>
    <option value="other">Others...</option>
  </select>

  <input type="text" id="otherLearningArea" placeholder="Enter Learning Area"
         style="display:none; margin-top:5px;">
</td>
  </tr>

  <tr>
    <td>Teaching Dates</td>
    <td id="dateRange"></td>
    <td>Quarter</td>
    <td>
      <select id="quarter">
        <option>1st</option>
        <option>2nd</option>
        <option>3rd</option>
        <option>4th</option>
      </select>
    </td>
  </tr>

  <tr>
    <td>Time</td>
    <td contenteditable="true" id="timeCell"></td>
    <td></td>
    <td></td>
  </tr>
</table>

<!-- PROCEDURES TABLE -->
<table id="proceduresTable">
  <tr>
    <td></td>
    <td>MONDAY</td>
    <td>TUESDAY</td>
    <td>WEDNESDAY</td>
    <td>THURSDAY</td>
    <td>FRIDAY</td>
  </tr>

  <tr>
    <td>Date</td>
    <td id="dateMon"></td>
    <td id="dateTue"></td>
    <td id="dateWed"></td>
    <td id="dateThu"></td>
    <td id="dateFri"></td>
  </tr>

  <!-- Roman (No indent) -->
  <tr style="background-color: #bfbfbf;">
    <td colspan="6"><b>I. OBJECTIVES</b></td>
  </tr>

  <!-- Alphabet (Indent 1) -->
  <tr>
    <td class="indent-1">A. GRADE LEVEL STANDARDS</td>
    <td colspan="5" contenteditable="true"></td>
  </tr>

  <tr>
    <td class="indent-1">B. Learning Competency</td>
    <td colspan="5" contenteditable="true"></td>
  </tr>

  <!-- Roman -->
  <tr>
    <td><b>II. CONTENT</b></td>
    <td contenteditable="true"></td><td contenteditable="true"></td>
    <td contenteditable="true"></td><td contenteditable="true"></td>
    <td contenteditable="true"></td>
  </tr>

  <!-- Roman -->
  <tr style="background-color: #bfbfbf;">
    <td colspan="6"><b>III. LEARNING RESOURCES</b></td>
  </tr>

  <!-- Alphabet -->
  <tr style="background-color: #bfbfbf;">
    <td class="indent-1" colspan="6"><b>A. References</b></td>
  </tr>

  <!-- Number (Indent 2) -->
  <tr>
    <td class="indent-2">1. Additional Materials from LR Portal</td>
    <td colspan="5" contenteditable="true"></td>
  </tr>

  <tr>
    <td class="indent-1">B. Other Learning Resources</td>
    <td colspan="5" contenteditable="true"></td>
  </tr>
  <tr style="background-color: #bfbfbf;">
    <td colspan="6"><b>IV. PROCEDURES</b></td>
  </tr>
  <tr>
    <td class="indent-1">A. Reviewing previous lesson</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">B. Establish a purpose</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">C. Examples/Instances</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">D. Discussing skills #1</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">E. Discussing skills #2</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">F. Developing Mastery</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">G. Applications</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">H. Generalization</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">I. Evaluating Learning</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td class="indent-1">J. Additional activities</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr>
    <td><b>V. REMARKS</b></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
  <tr style="background-color: #bfbfbf;">
    <td colspan="6"><b>VI. REFLECTIONS</b></td>
  </tr>
    <tr>
    <td class="indent-1">A. No. of learners who 
      earned 80% on the 
      formative assessment</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
    <tr>
    <td class="indent-1">B. No. of  learners who 
      require additional activities
      for remediation who scored 
      below 80%</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
    <tr>
    <td class="indent-1">C. Did the remedial 
      lessons work? No. of learners
      who have caught up 
      with the lesson</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
    <tr>
    <td class="indent-1">D. No. of learners who
      continue to require
      remediation</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
    <tr>
    <td class="indent-1">E. Which of my teaching
      strategies worked well? 
      Why did this work?</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
    <tr>
    <td class="indent-1">F. What difficulties did
      I encountered which my
      principal or supervisor
      can help me solve?</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
    <tr>
    <td class="indent-1">G. What innovation or
      localized materials did
      I use/discover which I
      wish to share with other 
      teachers?</td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
    <td class="editable" contenteditable="true"></td>
  </tr>
</table>

<button onclick="saveLesson()">Save Lesson</button>
<p id="status"></p>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDmb0oDlQVfEhcqx6OPgmWwump0b0R09xs",
  authDomain: "teachers-portal-98254.firebaseapp.com",
  projectId: "teachers-portal-98254",
  storageBucket: "teachers-portal-98254.firebasestorage.app",
  messagingSenderId: "479254583768",
  appId: "1:479254583768:web:b8dcf9da3a5616d5b37aad"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;

onAuthStateChanged(auth, async (user) => {
  if (!user) window.location.href = "login.html";
  currentUser = user;

  const snap = await getDoc(doc(db,"users",user.uid));
  if (snap.exists()) {
    document.getElementById("school").innerText = snap.data().school || "";
    document.getElementById("teacher").innerText = snap.data().name || "";
  }
});

function getMonday(date){
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1);
  return new Date(d.setDate(diff));
}

function formatRange(monday){
  const friday = new Date(monday);
  friday.setDate(monday.getDate()+4);

  const options = { month: "long" };

  const month1 = monday.toLocaleString("default", options);
  const month2 = friday.toLocaleString("default", options);

  if (month1 === month2) {
    return `${month1} ${monday.getDate()}-${friday.getDate()}, ${monday.getFullYear()}`;
  } else {
    return `${month1} ${monday.getDate()} - ${month2} ${friday.getDate()}, ${monday.getFullYear()}`;
  }
}

window.loadLesson = function(){
  const selected = document.getElementById("lessonDate").value;
  if (!selected) return;

  const monday = getMonday(selected);

  for(let i=0;i<5;i++){
    const d = new Date(monday);
    d.setDate(monday.getDate()+i);
    document.getElementById(["dateMon","dateTue","dateWed","dateThu","dateFri"][i])
      .innerText = d.toISOString().split("T")[0];
  }

  document.getElementById("dateRange").innerText = formatRange(monday);
};

window.saveLesson = async function(){
  const selected = document.getElementById("lessonDate").value;
  if (!selected) return;

  await setDoc(doc(db,"lessonPlans",currentUser.uid+"_"+selected),{
    date:selected,
    dateRange:document.getElementById("dateRange").innerText,
    time:document.getElementById("timeCell").innerText,
    tableHTML:document.getElementById("proceduresTable").innerHTML,
    userId:currentUser.uid
  });

  document.getElementById("status").innerText="Lesson Saved!";
};

 </div>

<button class="save-btn" onclick="saveData()">Save</button>
<button class="export-btn" onclick="exportToWord()">Export to Word</button>

</div>

<script>

/* ===== SAVE SAFELY ===== */
function saveData() {
  const data = {
    school: school.value,
    teacher: teacher.value,
    grade: grade.value,
    subject: subject.value,
    week: weekRange.innerText,
    time: time.value,
    contentStandard: contentStandard.value,
    performanceStandard: performanceStandard.value,
    competencies: competencies.value,
    content: content.value,
    references: references.value,
    otherResources: otherResources.value,
    procedure: procedure.value,
    remarks: remarks.value,
    reflection: reflection.value
  };

  localStorage.setItem("lessonPlan", JSON.stringify(data));
  alert("Saved successfully!");
}

/* ===== EXPORT TO WORD ===== */
function exportToWord() {

  let content = document.getElementById("documentArea").innerHTML;

  let header = `
  <html xmlns:o='urn:schemas-microsoft-com:office:office'
  xmlns:w='urn:schemas-microsoft-com:office:word'
  xmlns='http://www.w3.org/TR/REC-html40'>
  <head><meta charset='utf-8'></head><body>`;

  let footer = "</body></html>";

  let sourceHTML = header + content + footer;

  let blob = new Blob(['\ufeff', sourceHTML], {
    type: 'application/msword'
  });

  let url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(sourceHTML);

  let downloadLink = document.createElement("a");
  document.body.appendChild(downloadLink);

  downloadLink.href = url;
  downloadLink.download = "Detailed_Lesson_Plan.doc";
  downloadLink.click();

  document.body.removeChild(downloadLink);
}

</script>
<script>
function checkLearningArea(select) {
  const otherInput = document.getElementById("otherLearningArea");

  if (select.value === "other") {
    otherInput.style.display = "block";
    otherInput.focus();
  } else {
    otherInput.style.display = "none";
  }
}
</script>

</body>
</html>
